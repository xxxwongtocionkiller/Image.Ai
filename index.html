<!DOCTYPE html>
<html lang="sw">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DarkX Image Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet" />
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #1e1e2f 0%, #1a237e 100%);
    color: #fff;
    min-height: 100vh;
  }
  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  .animate-spin-custom {
    animation: spin 1s linear infinite;
  }
  .message-box {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    padding: 0.75rem 1.5rem;
    background-color: #ef4444;
    color: white;
    border-radius: 9999px;
    box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
    transition: opacity 0.3s ease-in-out;
    z-index: 1000;
  }
  .message-box.hidden {
    opacity: 0;
    pointer-events: none;
  }
  .history-box::-webkit-scrollbar {
    width: 8px;
  }
  .history-box::-webkit-scrollbar-track {
    background: #2b2b40;
    border-radius: 10px;
  }
  .history-box::-webkit-scrollbar-thumb {
    background: #3f51b5;
    border-radius: 10px;
  }
  .history-box::-webkit-scrollbar-thumb:hover {
    background: #5c6bc0;
  }
</style>
</head>
<body class="flex flex-col items-center justify-center p-4">
  <div class="container mx-auto p-8 max-w-4xl bg-[#1e1e2f] bg-opacity-70 rounded-3xl shadow-2xl backdrop-blur-md">
    <div class="text-center mb-8">
      <h1 class="text-5xl font-extrabold text-blue-400 mb-2">DarkX Image Generator</h1>
      <p class="text-gray-300 text-lg max-w-2xl mx-auto">
        Andika maelezo ya picha unayotaka kutengeneza, kisha bonyeza kitufe hapa chini.
      </p>
    </div>
    <div class="w-full bg-[#1a1a2e] p-6 sm:p-10 rounded-2xl shadow-xl border border-[#2b2b40]">
      <textarea
        id="prompt-input"
        rows="4"
        class="w-full p-4 text-lg bg-[#2b2b40] text-gray-200 border border-[#3f51b5] rounded-xl focus:border-blue-500 focus:ring-blue-500 focus:outline-none transition-all resize-none placeholder-gray-400"
        placeholder="Mfano: 'Kijana mchawi anayesimama kwenye mlima, mandhari ya ajabu, mtindo wa fantasia'"
      ></textarea>
      <button
        id="generate-button"
        class="w-full mt-6 p-4 text-xl font-bold text-white bg-blue-600 hover:bg-blue-700 rounded-xl shadow-lg transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-400"
      >
        Tengeneza Picha
      </button>
      <div
        id="image-display"
        class="mt-8 relative min-h-[350px] flex items-center justify-center bg-[#2b2b40] rounded-xl overflow-hidden shadow-inner border border-[#3f51b5]"
      >
        <img
          id="generated-image"
          src="https://placehold.co/600x400/3f51b5/ffffff?text=Picha+yako+itaonekana+hapa"
          alt="Picha iliyotengenezwa"
          class="hidden w-full h-full object-cover transition-opacity duration-300"
        />
        <div id="loading-spinner" class="hidden flex-col items-center justify-center">
          <svg
            class="animate-spin-custom h-12 w-12 text-blue-500"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
          <p class="text-gray-400 mt-4 text-lg">Inatengeneza picha...</p>
        </div>
      </div>
    </div>
    <div class="mt-12 w-full bg-[#1a1a2e] p-6 rounded-2xl shadow-xl border border-[#2b2b40]">
      <h3 class="text-2xl font-bold text-gray-300 mb-4">Historia ya Picha</h3>
      <div class="history-box max-h-48 overflow-y-auto">
        <ul class="space-y-3 text-gray-400" id="history-list">
          <!-- History items go here -->
        </ul>
      </div>
    </div>
    <div class="mt-8 text-center text-gray-500 text-sm font-light">
      <span
        >Imeundwa na <span class="font-semibold text-blue-400">DarkX Developer</span></span
      >
    </div>
  </div>

  <div id="message-box" class="message-box hidden">
    <p id="message-text" class="text-base font-medium"></p>
  </div>

  <script>
    const promptInput = document.getElementById('prompt-input');
    const generateButton = document.getElementById('generate-button');
    const generatedImage = document.getElementById('generated-image');
    const loadingSpinner = document.getElementById('loading-spinner');
    const messageBox = document.getElementById('message-box');
    const messageText = document.getElementById('message-text');
    const historyList = document.getElementById('history-list');

    function showMessage(message, duration = 3000) {
      messageText.textContent = message;
      messageBox.classList.remove('hidden');
      setTimeout(() => {
        messageBox.classList.add('hidden');
      }, duration);
    }

    async function generateImageFromAPI(prompt) {
      const apiKey = 'AIzaSyBwViNwAHjr0EUNGskcxpTA_5_0CwUgX64';
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-preview-image-generation:generateContent?key=${apiKey}`;

      const payload = {
        contents: [
          {
            parts: [{ text: prompt }],
          },
        ],
        generationConfig: {
          responseModalities: ['IMAGE'],
        },
      };

      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });

        if (!response.ok) {
          throw new Error(`API error: ${response.status} ${response.statusText}`);
        }

        const data = await response.json();
        const base64Image =
          data?.candidates?.[0]?.content?.parts?.find((p) => p.inlineData)?.inlineData?.data;

        if (!base64Image) throw new Error('Hakuna picha iliyorudishwa na API.');

        return `data:image/png;base64,${base64Image}`;
      } catch (error) {
        console.error('API error:', error);
        throw error;
      }
    }

    async function generateImage() {
      const prompt = promptInput.value.trim();

      if (!prompt) {
        showMessage('Tafadhali ingiza maelezo ya picha.', 4000);
        return;
      }

      generatedImage.classList.add('hidden');
      loadingSpinner.classList.remove('hidden');

      try {
        const imageUrl = await generateImageFromAPI(prompt);
        generatedImage.src = imageUrl;
        generatedImage.classList.remove('hidden');

        // Add prompt to history
        addToHistory(prompt);
      } catch (error) {
        showMessage('Hitilafu imetokea wakati wa kutengeneza picha. Jaribu tena.', 5000);
      } finally {
        loadingSpinner.classList.add('hidden');
      }
    }

    function addToHistory(prompt) {
      const li = document.createElement('li');
      li.className = 'flex items-center space-x-2';

      const svgNS = 'http://www.w3.org/2000/svg';
      const svg = document.createElementNS(svgNS, 'svg');
      svg.setAttribute('class', 'h-5 w-5 text-purple-400');
      svg.setAttribute('viewBox', '0 0 20 20');
      svg.setAttribute('fill', 'currentColor');

      const path = document.createElementNS(svgNS, 'path');
      path.setAttribute(
        'd',
        'M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z'
      );
      path.setAttribute('fill-rule', 'evenodd');
      path.setAttribute('clip-rule', 'evenodd');
      svg.appendChild(path);

      const span = document.createElement('span');
      span.textContent = prompt;

      li.appendChild(svg);
      li.appendChild(span);

      historyList.prepend(li); // Add new prompt to top of history
    }

    generateButton.addEventListener('click', generateImage);
    promptInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        generateImage();
      }
    });
  </script>
</body>
  </html>
